<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Advanced Usage &#8212; kraken  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=89a84cc7" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="canonical" href="kraken.re/advanced.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Training" href="ketos.html" />
    <link rel="prev" title="kraken" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="advanced-usage">
<span id="advanced"></span><h1>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Link to this heading">¶</a></h1>
<p>Optical character recognition is the serial execution of multiple steps, in the
case of kraken binarization (converting color and grayscale images into bitonal
ones), layout analysis/page segmentation (extracting topological text lines
from an image), recognition (feeding text lines images into an classifiers),
and finally serialization of results into an appropriate format such as hOCR or
ALTO.</p>
<section id="input-specification">
<h2>Input Specification<a class="headerlink" href="#input-specification" title="Link to this heading">¶</a></h2>
<p>All kraken subcommands operating on input-output pairs, i.e. producing one
output document for one input document follow the basic syntax:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span>input_1<span class="w"> </span>output_1<span class="w"> </span>-i<span class="w"> </span>input_2<span class="w"> </span>output_2<span class="w"> </span>...<span class="w"> </span>subcommand_1<span class="w"> </span>subcommand_2<span class="w"> </span>...<span class="w"> </span>subcommand_n
</pre></div>
</div>
<p>In particular subcommands may be chained.</p>
</section>
<section id="binarization">
<h2>Binarization<a class="headerlink" href="#binarization" title="Link to this heading">¶</a></h2>
<p>The binarization subcommand accepts almost the same parameters as
<code class="docutils literal notranslate"><span class="pre">ocropus-nlbin</span></code>. Only options not related to binarization, e.g. skew
detection are missing. In addition, error checking (image sizes, inversion
detection, grayscale enforcement) is always disabled and kraken will happily
binarize any image that is thrown at it.</p>
<p>Available parameters are:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>option</p></th>
<th class="head"><p>type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>–threshold</p></td>
<td><p>FLOAT</p></td>
</tr>
<tr class="row-odd"><td><p>–zoom</p></td>
<td><p>FLOAT</p></td>
</tr>
<tr class="row-even"><td><p>–escale</p></td>
<td><p>FLOAT</p></td>
</tr>
<tr class="row-odd"><td><p>–border</p></td>
<td><p>FLOAT</p></td>
</tr>
<tr class="row-even"><td><p>–perc</p></td>
<td><p>INTEGER RANGE</p></td>
</tr>
<tr class="row-odd"><td><p>–range</p></td>
<td><p>INTEGER</p></td>
</tr>
<tr class="row-even"><td><p>–low</p></td>
<td><p>INTEGER RANGE</p></td>
</tr>
<tr class="row-odd"><td><p>–high</p></td>
<td><p>INTEGER RANGE</p></td>
</tr>
</tbody>
</table>
</section>
<section id="page-segmentation-and-script-detection">
<h2>Page Segmentation and Script Detection<a class="headerlink" href="#page-segmentation-and-script-detection" title="Link to this heading">¶</a></h2>
<p>The <cite>segment</cite> subcommand access two operations page segmentation into lines and
script detection of those lines.</p>
<p>Page segmentation is mostly parameterless, although a switch to change the
color of column separators has been retained. The segmentation is written as a
<a class="reference external" href="http://json.org/">JSON</a> file containing bounding boxes in reading order and
the general text direction (horizontal, i.e. LTR or RTL text in top-to-bottom
reading order or vertical-ltr/rtl for vertical lines read from left-to-right or
right-to-left).</p>
<p>The script detection splits extracted lines from the segmenter into strip
sharing a particular script that can then be recognized by supplying
appropriate models for each detected script to the <cite>ocr</cite> subcommand.</p>
<p>Combined output from both consists of lists in the <cite>boxes</cite> field corresponding
to a topographical line and containing one or more bounding boxes of a
particular script. Identifiers are <a class="reference external" href="http://www.unicode.org/iso15924/iso15924-codes.html">ISO 15924</a> 4 character codes.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span><span class="m">14</span>.tif<span class="w"> </span>lines.txt<span class="w"> </span>segment
<span class="gp">$ </span>cat<span class="w"> </span>lines.json
<span class="go">{</span>
<span class="go">   &quot;boxes&quot; : [</span>
<span class="go">    [</span>
<span class="go">        [&quot;Grek&quot;, [561, 216, 1626,309]]</span>
<span class="go">    ],</span>
<span class="go">    [</span>
<span class="go">        [&quot;Latn&quot;, [2172, 197, 2424, 244]]</span>
<span class="go">    ],</span>
<span class="go">    [</span>
<span class="go">        [&quot;Grek&quot;, [1678, 221, 2236, 320]],</span>
<span class="go">        [&quot;Arab&quot;, [2241, 221, 2302, 320]]</span>
<span class="go">    ],</span>

<span class="go">        [&quot;Grek&quot;, [412, 318, 2215, 416]],</span>
<span class="go">        [&quot;Latn&quot;, [2208, 318, 2424, 416]]</span>
<span class="go">    ],</span>
<span class="go">    ...</span>
<span class="go">   ],</span>
<span class="go">   &quot;text_direction&quot; : &quot;horizontal-tb&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Script detection is automatically enabled; by explicitly disabling script
detection the <cite>boxes</cite> field will contain only a list of line bounding boxes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[546, 216, 1626, 309],</span>
<span class="go">[2169, 197, 2423, 244],</span>
<span class="go">[1676, 221, 2293, 320],</span>
<span class="go">...</span>
<span class="go">[503, 2641, 848, 2681]</span>
</pre></div>
</div>
<p>Available page segmentation parameters are:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>option</p></th>
<th class="head"><p>action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-d, –text-direction</p></td>
<td><p>Sets principal text direction. Valid values are <cite>horizontal-lr</cite>, <cite>horizontal-rl</cite>, <cite>vertical-lr</cite>, and <cite>vertical-rl</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>–scale FLOAT</p></td>
<td><p>Estimate of the average line height on the page</p></td>
</tr>
<tr class="row-even"><td><p>-m, –maxcolseps</p></td>
<td><p>Maximum number of columns in the input document. Set to <cite>0</cite> for uni-column layouts.</p></td>
</tr>
<tr class="row-odd"><td><p>-b, –black-colseps / -w, –white-colseps</p></td>
<td><p>Switch to black column separators.</p></td>
</tr>
<tr class="row-even"><td><p>-r, –remove-hlines / -l, –hlines</p></td>
<td><p>Disables prefiltering of small horizontal lines. Improves segmenter output on some Arabic texts.</p></td>
</tr>
</tbody>
</table>
<p>The parameters specific to the script identification are:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>option</p></th>
<th class="head"><p>action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-s/-n</p></td>
<td><p>Enables/disables script detection</p></td>
</tr>
<tr class="row-odd"><td><p>-a, –allowed-script</p></td>
<td><p>Whitelists specific scripts for detection output. Other detected script runs are merged with their adjacent scripts, after a heuristic pre-merging step.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="model-repository">
<h2>Model Repository<a class="headerlink" href="#model-repository" title="Link to this heading">¶</a></h2>
<p>There is a semi-curated <a class="reference external" href="https://github.com/mittagessen/kraken-models">repository</a> of freely licensed recognition
models that can be accessed from the command line using a few subcommands. For
evaluating a series of models it is also possible to just clone the repository
using the normal git client.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">list</span></code> subcommand retrieves a list of all models available and prints
them including some additional information (identifier, type, and a short
description):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>list
<span class="go">Retrieving model list   ✓</span>
<span class="go">default (pyrnn) - A converted version of en-default.pyrnn.gz</span>
<span class="go">toy (clstm) - A toy model trained on 400 lines of the UW3 data set.</span>
<span class="go">...</span>
</pre></div>
</div>
<p>To access more detailed information the <code class="docutils literal notranslate"><span class="pre">show</span></code> subcommand may be used:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>show<span class="w"> </span>toy
<span class="go">name: toy.clstm</span>

<span class="go">A toy model trained on 400 lines of the UW3 data set.</span>

<span class="go">author: Benjamin Kiessling (mittagessen@l.unchti.me)</span>
<span class="go">http://kraken.re</span>
</pre></div>
</div>
<p>If a suitable model has been decided upon it can be retrieved using the <code class="docutils literal notranslate"><span class="pre">get</span></code>
subcommand:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>get<span class="w"> </span>toy
<span class="go">Retrieving model        ✓</span>
</pre></div>
</div>
<p>Models will be placed in $XDG_BASE_DIR and can be accessed using their name as
shown by the <code class="docutils literal notranslate"><span class="pre">show</span></code> command, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span>...<span class="w"> </span>...<span class="w"> </span>ocr<span class="w"> </span>-m<span class="w"> </span>toy
</pre></div>
</div>
<p>Additions and updates to existing models are always welcome! Just open a pull
request or write an email.</p>
</section>
<section id="recognition">
<h2>Recognition<a class="headerlink" href="#recognition" title="Link to this heading">¶</a></h2>
<p>Recognition requires a grey-scale or binarized image, a page segmentation for
that image, and a model file. In particular there is no requirement to use the
page segmentation algorithm contained in the <code class="docutils literal notranslate"><span class="pre">segment</span></code> subcommand or the
binarization provided by kraken.</p>
<p>Multi-script recognition is possible by supplying a script-annotated
segmentation and a mapping between scripts and models:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span>...<span class="w"> </span>...<span class="w"> </span>ocr<span class="w"> </span>-m<span class="w"> </span>Grek:porson.clstm<span class="w"> </span>-m<span class="w"> </span>Latn:antiqua.clstm
</pre></div>
</div>
<p>All polytonic Greek text portions will be recognized using the <cite>porson.clstm</cite>
model while Latin text will be fed into the <cite>antiqua.clstm</cite> model. It is
possible to define a fallback model that other text will be fed to:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span>...<span class="w"> </span>...<span class="w"> </span>ocr<span class="w"> </span>-m<span class="w"> </span>...<span class="w"> </span>-m<span class="w"> </span>...<span class="w"> </span>-m<span class="w"> </span>default:porson.clstm
</pre></div>
</div>
<p>It is also possible to disable recognition on a particular script by mapping to
the special model keyword <cite>ignore</cite>. Ignored lines will still be serialized but
will not contain any recognition results.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ocr</span></code> subcommand is able to serialize the recognition results either as
plain text (default), as <a class="reference external" href="http://hocr.info">hOCR</a>, into <a class="reference external" href="http://www.loc.gov/standards/alto/">ALTO</a>, or abbyyXML containing additional
metadata such as bounding boxes and confidences:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span>...<span class="w"> </span>...<span class="w"> </span>ocr<span class="w"> </span>-t<span class="w"> </span><span class="c1"># text output</span>
<span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span>...<span class="w"> </span>...<span class="w"> </span>ocr<span class="w"> </span>-h<span class="w"> </span><span class="c1"># hOCR output</span>
<span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span>...<span class="w"> </span>...<span class="w"> </span>ocr<span class="w"> </span>-a<span class="w"> </span><span class="c1"># ALTO output</span>
<span class="gp">$ </span>kraken<span class="w"> </span>-i<span class="w"> </span>...<span class="w"> </span>...<span class="w"> </span>ocr<span class="w"> </span>-y<span class="w"> </span><span class="c1"># abbyyXML output</span>
</pre></div>
</div>
<p>hOCR output is slightly different from hOCR files produced by ocropus. Each
<code class="docutils literal notranslate"><span class="pre">ocr_line</span></code> span contains not only the bounding box of the line but also
character boxes (<code class="docutils literal notranslate"><span class="pre">x_bboxes</span></code> attribute) indicating the coordinates of each
character. In each line alternating sequences of alphanumeric and
non-alphanumeric (in the unicode sense) characters are put into <code class="docutils literal notranslate"><span class="pre">ocrx_word</span></code>
spans. Both have bounding boxes as attributes and the recognition confidence
for each character in the <code class="docutils literal notranslate"><span class="pre">x_conf</span></code> attribute.</p>
<p>Paragraph detection has been removed as it was deemed to be unduly dependent on
certain typographic features which may not be valid for your input.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/kraken.png" alt="Logo of kraken"/>
            </a></p>
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Advanced Usage</a><ul>
<li><a class="reference internal" href="#input-specification">Input Specification</a></li>
<li><a class="reference internal" href="#binarization">Binarization</a></li>
<li><a class="reference internal" href="#page-segmentation-and-script-detection">Page Segmentation and Script Detection</a></li>
<li><a class="reference internal" href="#model-repository">Model Repository</a></li>
<li><a class="reference internal" href="#recognition">Recognition</a></li>
</ul>
</li>
</ul>

  </div><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">kraken</a></li>
      <li>Next: <a href="ketos.html" title="next chapter">Training</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
<h3>Versions</h3>
<ul>
  <li><a href="advanced.html">2.0.0</a></li>
  <li><a href="../3.0/advanced.html">3.0</a></li>
  <li><a href="../4.0/advanced.html">4.0</a></li>
  <li><a href="../4.1/advanced.html">4.1</a></li>
  <li><a href="../4.2.0/advanced.html">4.2.0</a></li>
  <li><a href="../4.3.0/advanced.html">4.3.0</a></li>
  <li><a href="../5.0.0/advanced.html">5.0.0</a></li>
  <li><a href="../5.2/advanced.html">5.2</a></li>
  <li><a href="../5.3.0/advanced.html">5.3.0</a></li>
  <li><a href="../6.0.0/index.html">6.0.0</a></li>
  <li><a href="../main/index.html">main</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2015-2025, Benjamin Kiessling.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/advanced.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>